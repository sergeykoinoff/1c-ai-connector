#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ВходящийТекст = ПолучитьПримерПоУмолчанию();
	ОбновитьHTML();
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура Преобразовать(Команда)
	
	ОбновитьHTML();
	
КонецПроцедуры

&НаКлиенте
Процедура Очистить(Команда)
	
	ВходящийТекст = "";
	HTML = "";
	
КонецПроцедуры

&НаКлиенте
Процедура ПримерБазовый(Команда)
	
	ВходящийТекст = ПолучитьПримерБазовый();
	ОбновитьHTML();
	
КонецПроцедуры

&НаКлиенте
Процедура ПримерСписки(Команда)
	
	ВходящийТекст = ПолучитьПримерСписки();
	ОбновитьHTML();
	
КонецПроцедуры

&НаКлиенте
Процедура ПримерТаблицы(Команда)
	
	ВходящийТекст = ПолучитьПримерТаблицы();
	ОбновитьHTML();
	
КонецПроцедуры

&НаКлиенте
Процедура ПримерКод(Команда)
	
	ВходящийТекст = ПолучитьПримерКод();
	ОбновитьHTML();
	
КонецПроцедуры

&НаКлиенте
Процедура ПримерВсе(Команда)
	
	ВходящийТекст = ПолучитьПримерВсе();
	ОбновитьHTML();
	
КонецПроцедуры

&НаКлиенте
Процедура ПримерЦитаты(Команда)
	
	ВходящийТекст = ПолучитьПримерЦитаты();
	ОбновитьHTML();
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура ОбновитьHTML()
	
	Попытка
		HTMLРезультат = КИИ_МаркдаунПарсерКлиентСервер.ПреобразоватьВHTML(ВходящийТекст);
		HTML = ОбернутьВHTMLШаблон(HTMLРезультат);
	Исключение
		ТекстОшибки = ОбработкаОшибок.ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
		ОписаниеОшибкиHTML = СтрШаблон(
			"<div style='color: red;'><strong>%1</strong><br>%2</div>",
			НСтр("ru = 'ОШИБКА:'"),
			ТекстОшибки);
		HTML = ОбернутьВHTMLШаблон(ОписаниеОшибкиHTML);
	КонецПопытки;
	ЧистыйHTML = HTML;
	
КонецПроцедуры

&НаСервере
Функция ОбернутьВHTMLШаблон(Знач Содержимое)
	
	Макет = Обработки.КИИ_ТестМаркдаунПарсера.ПолучитьМакет("ШаблонHTML");
	ШаблонТекст = Макет.ПолучитьТекст();
	
	Возврат СтрЗаменить(ШаблонТекст, "{CONTENT}", Содержимое);
	
КонецФункции

#Область Примеры

&НаСервере
Функция ПолучитьПримерПоУмолчанию()
	
	Возврат НСтр("ru = '# Добро пожаловать в тест Markdown парсера
		|
		|Введите текст в формате **Markdown** и нажмите **Преобразовать**.
		|
		|Используйте кнопки ниже для быстрой вставки примеров.'");
	
КонецФункции

&НаСервере
Функция ПолучитьПримерБазовый()
	
	Возврат НСтр("ru = '# Заголовок 1 уровня
		|## Заголовок 2 уровня
		|### Заголовок 3 уровня
		|
		|Обычный текст с **жирным шрифтом**, *курсивом* и ***жирным курсивом***.
		|
		|Текст с ~~зачёркиванием~~ и `inline кодом`.
		|
		|Ссылка: [1С:ИИКона](https://github.com/username/iikona)
		|
		|---
		|
		|Горизонтальная линия выше.'");
	
КонецФункции

&НаСервере
Функция ПолучитьПримерСписки()
	
	Возврат НСтр("ru = '## Маркированный список:
		|
		|- Первый элемент
		|- Второй элемент
		|- Третий элемент
		|
		|## Нумерованный список:
		|
		|1. Первый пункт
		|2. Второй пункт
		|3. Третий пункт
		|4. Четвёртый пункт
		|
		|## Смешанные списки:
		|
		|- Маркированный элемент
		|- Ещё один элемент
		|
		|1. Нумерованный элемент
		|2. Следующий элемент'");
	
КонецФункции

&НаСервере
Функция ПолучитьПримерТаблицы()
	
	Возврат НСтр("ru = '## Таблица провайдеров ИИ:
		|
		|| Провайдер | Модель | Поддержка |
		||-----------|--------|-----------|
		|| OpenAI | GPT-4 | Да |
		|| Anthropic | Claude | Да |
		|| Google | Gemini | Да |
		|| Яндекс | YandexGPT | Да |
		|
		|Таблицы поддерживают выравнивание и форматирование внутри ячеек.'");
	
КонецФункции

&НаСервере
Функция ПолучитьПримерКод()
	
	Возврат НСтр("ru = '## Примеры кода:
		|
		|Inline код: используйте `Сообщить(""Привет"")` для вывода.
		|
		|### Блок кода на 1С:
		|
		|```bsl
		|Функция ПолучитьСуммуДокумента(Документ)
		|    
		|    Запрос = Новый Запрос;
		|    Запрос.Текст = ""
		|        |ВЫБРАТЬ
		|        |    СУММА(Товары.Сумма) КАК Сумма
		|        |ИЗ
		|        |    Документ.РеализацияТоваров.Товары КАК Товары
		|        |ГДЕ
		|        |    Товары.Ссылка = &Ссылка"";
		|    
		|    Запрос.УстановитьПараметр(""Ссылка"", Документ);
		|    
		|    Результат = Запрос.Выполнить();
		|    Выборка = Результат.Выбрать();
		|    
		|    Если Выборка.Следующий() Тогда
		|        Возврат Выборка.Сумма;
		|    КонецЕсли;
		|    
		|    Возврат 0;
		|    
		|КонецФункции
		|```
		|
		|### Python пример:
		|
		|```python
		|def hello_world():
		|    print(''Hello, World'')
		|    return True
		|```'");
	
КонецФункции

&НаСервере
Функция ПолучитьПримерЦитаты()
	
	Возврат НСтр("ru = '## Цитаты:
		|
		|> Это простая цитата.
		|
		|> Многострочная цитата
		|> может содержать **форматирование**
		|> и `код`.
		|
		|## Вложенные цитаты:
		|
		|> Уровень 1
		|>> Уровень 2
		|>>> Уровень 3
		|>> Снова уровень 2
		|> Уровень 1'");
	
КонецФункции

&НаСервере
Функция ПолучитьПримерВсе()
	
	Возврат НСтр("ru = '# Полный тест Markdown
		|
		|## Форматирование текста
		|
		|**Жирный**, *курсив*, ***жирный курсив***, ~~зачёркнутый~~, `код`.
		|
		|## Списки
		|
		|1. Первый
		|2. Второй
		|3. Третий
		|
		|- Элемент A
		|- Элемент B
		|
		|## Таблица
		|
		|| Столбец 1 | Столбец 2 |
		||-----------|-----------|
		|| Данные 1  | Данные 2  |
		|
		|## Код
		|
		|```bsl
		|Сообщить(""Привет"");
		|```
		|
		|## Цитата
		|
		|> Важная цитата
		|
		|---
		|
		|Ссылка: [GitHub](https://github.com)'");
	
КонецФункции

#КонецОбласти

#КонецОбласти
